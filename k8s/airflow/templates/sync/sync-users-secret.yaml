---
# Source: airflow/templates/sync/sync-users-secret.yaml
apiVersion: v1
kind: Secret
metadata:
  name: airflow-sync-users
  labels:
    app: airflow
    component: sync-users
    chart: airflow-8.7.1
    release: airflow
    heritage: Helm
data:
  sync_users.py: "CiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyBCRUdJTjogR0xPQkFMIENPREUgIyMjIwojIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjCiMjIEdsb2JhbCBJbXBvcnRzICMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjCmltcG9ydCBsb2dnaW5nCmltcG9ydCBvcwppbXBvcnQgdGltZQpmcm9tIHN0cmluZyBpbXBvcnQgVGVtcGxhdGUKZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIERpY3QsIE9wdGlvbmFsCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMgR2xvYmFsIENvbmZpZ3MgIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyB0aGUgcGF0aCB3aGljaCBTZWNyZXQvQ29uZmlnTWFwIGFyZSBtb3VudGVkIHRvCkNPTkZfX1RFTVBMQVRFU19QQVRIID0gIi9tbnQvdGVtcGxhdGVzIgoKIyBob3cgZnJlcXVlbnRseSB0byBjaGVjayBmb3IgU2VjcmV0L0NvbmZpZ01hcCB1cGRhdGVzCkNPTkZfX1RFTVBMQVRFU19TWU5DX0lOVEVSVkFMID0gMTAKCiMgaG93IGZyZXF1ZW50bHkgdG8gcmUtc3luYyBvYmplY3RzIChDb25uZWN0aW9ucywgUG9vbHMsIFVzZXJzLCBWYXJpYWJsZXMpCkNPTkZfX09CSkVDVFNfU1lOQ19JTlRFUlZBTCA9IDYwCgoKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIwojIyBHbG9iYWwgRnVuY3Rpb25zICMjCiMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKZGVmIHN0cmluZ19zdWJzdGl0dXRpb24ocmF3X3N0cmluZzogT3B0aW9uYWxbc3RyXSwgc3Vic3RpdHV0aW9uX21hcDogRGljdFtzdHIsIHN0cl0pIC0+IHN0cjoKICAgICIiIgogICAgQXBwbHkgYmFzaC1saWtlIHN1YnN0aXR1dGlvbnMgdG8gYSByYXcgc3RyaW5nLgoKICAgIEV4YW1wbGU6CiAgICAtIHN0cmluZ19zdWJzdGl0dXRpb24oIkhlbGxvISIsIE5vbmUpIC0+ICJIZWxsbyEiCiAgICAtIHN0cmluZ19zdWJzdGl0dXRpb24oIkhlbGxvICR7TkFNRX0hIiwgeyJOQU1FIjogIkFpcmZsb3cifSkgLT4gIkhlbGxvIEFpcmZsb3chIgogICAgIiIiCiAgICBpZiByYXdfc3RyaW5nIGFuZCBsZW4oc3Vic3RpdHV0aW9uX21hcCkgPiAwOgogICAgICAgIHRwbCA9IFRlbXBsYXRlKHJhd19zdHJpbmcpCiAgICAgICAgcmV0dXJuIHRwbC5zYWZlX3N1YnN0aXR1dGUoc3Vic3RpdHV0aW9uX21hcCkKICAgIGVsc2U6CiAgICAgICAgcmV0dXJuIHJhd19zdHJpbmcKCgpkZWYgdGVtcGxhdGVfbXRpbWUodGVtcGxhdGVfbmFtZTogc3RyKSAtPiBmbG9hdDoKICAgICIiIgogICAgUmV0dXJuIHRoZSBtb2RpZmljYXRpb24tdGltZSBvZiB0aGUgZmlsZSBzdG9yaW5nIGB0ZW1wbGF0ZV9uYW1lYAogICAgIiIiCiAgICBmaWxlX3BhdGggPSBmIntDT05GX19URU1QTEFURVNfUEFUSH0ve3RlbXBsYXRlX25hbWV9IgogICAgcmV0dXJuIG9zLnN0YXQoZmlsZV9wYXRoKS5zdF9tdGltZQoKCmRlZiB0ZW1wbGF0ZV92YWx1ZSh0ZW1wbGF0ZV9uYW1lOiBzdHIpIC0+IHN0cjoKICAgICIiIgogICAgUmV0dXJuIHRoZSBjb250ZW50cyBvZiB0aGUgZmlsZSBzdG9yaW5nIGB0ZW1wbGF0ZV9uYW1lYAogICAgIiIiCiAgICBmaWxlX3BhdGggPSBmIntDT05GX19URU1QTEFURVNfUEFUSH0ve3RlbXBsYXRlX25hbWV9IgogICAgd2l0aCBvcGVuKGZpbGVfcGF0aCwgInIiKSBhcyBmOgogICAgICAgIHJldHVybiBmLnJlYWQoKQoKCmRlZiByZWZyZXNoX3RlbXBsYXRlX2NhY2hlKHRlbXBsYXRlX25hbWVzOiBMaXN0W3N0cl0sCiAgICAgICAgICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlX210aW1lX2NhY2hlOiBEaWN0W3N0ciwgZmxvYXRdLAogICAgICAgICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZV92YWx1ZV9jYWNoZTogRGljdFtzdHIsIHN0cl0pIC0+IExpc3Rbc3RyXToKICAgICIiIgogICAgUmVmcmVzaCB0aGUgcHJvdmlkZWQgZGljdGlvbmFyeSBjYWNoZXMgb2YgdGVtcGxhdGUgdmFsdWVzICYgbXRpbWVzLgoKICAgIDpwYXJhbSB0ZW1wbGF0ZV9uYW1lczogdGhlIG5hbWVzIG9mIGFsbCB0ZW1wbGF0ZXMgdG8gcmVmcmVzaAogICAgOnBhcmFtIHRlbXBsYXRlX210aW1lX2NhY2hlOiB0aGUgZGljdGlvbmFyeSBjYWNoZSBvZiB0ZW1wbGF0ZSBmaWxlIG1vZGlmaWNhdGlvbi10aW1lcwogICAgOnBhcmFtIHRlbXBsYXRlX3ZhbHVlX2NhY2hlOiB0aGUgZGljdGlvbmFyeSBjYWNoZSBvZiB0ZW1wbGF0ZSB2YWx1ZXMKICAgIDpyZXR1cm46IHRoZSBuYW1lcyBvZiB0ZW1wbGF0ZXMgd2hpY2ggY2hhbmdlZAogICAgIiIiCiAgICBjaGFuZ2VkX3RlbXBsYXRlcyA9IFtdCiAgICBmb3IgdGVtcGxhdGVfbmFtZSBpbiB0ZW1wbGF0ZV9uYW1lczoKICAgICAgICBvbGRfbXRpbWUgPSB0ZW1wbGF0ZV9tdGltZV9jYWNoZS5nZXQodGVtcGxhdGVfbmFtZSwgTm9uZSkKICAgICAgICBuZXdfbXRpbWUgPSB0ZW1wbGF0ZV9tdGltZSh0ZW1wbGF0ZV9uYW1lKQogICAgICAgICMgZmlyc3QsIGNoZWNrIGlmIHRoZSBmaWxlcyB3ZXJlIG1vZGlmaWVkCiAgICAgICAgaWYgb2xkX210aW1lICE9IG5ld19tdGltZToKICAgICAgICAgICAgb2xkX3ZhbHVlID0gdGVtcGxhdGVfdmFsdWVfY2FjaGUuZ2V0KHRlbXBsYXRlX25hbWUsIE5vbmUpCiAgICAgICAgICAgIG5ld192YWx1ZSA9IHRlbXBsYXRlX3ZhbHVlKHRlbXBsYXRlX25hbWUpCiAgICAgICAgICAgICMgc2Vjb25kLCBjaGVjayBpZiB0aGUgdmFsdWUgYWN0dWFsbHkgY2hhbmdlZAogICAgICAgICAgICBpZiBvbGRfdmFsdWUgIT0gbmV3X3ZhbHVlOgogICAgICAgICAgICAgICAgdGVtcGxhdGVfdmFsdWVfY2FjaGVbdGVtcGxhdGVfbmFtZV0gPSBuZXdfdmFsdWUKICAgICAgICAgICAgICAgIGNoYW5nZWRfdGVtcGxhdGVzICs9IFt0ZW1wbGF0ZV9uYW1lXQogICAgICAgICAgICB0ZW1wbGF0ZV9tdGltZV9jYWNoZVt0ZW1wbGF0ZV9uYW1lXSA9IG5ld19tdGltZQogICAgcmV0dXJuIGNoYW5nZWRfdGVtcGxhdGVzCgoKZGVmIG1haW4oc3luY19mb3JldmVyOiBib29sKToKICAgICMgaW5pdGlhbCBzeW5jIG9mIHRlbXBsYXRlIGNhY2hlCiAgICByZWZyZXNoX3RlbXBsYXRlX2NhY2hlKAogICAgICAgIHRlbXBsYXRlX25hbWVzPVZBUl9fVEVNUExBVEVfTkFNRVMsCiAgICAgICAgdGVtcGxhdGVfbXRpbWVfY2FjaGU9VkFSX19URU1QTEFURV9NVElNRV9DQUNIRSwKICAgICAgICB0ZW1wbGF0ZV92YWx1ZV9jYWNoZT1WQVJfX1RFTVBMQVRFX1ZBTFVFX0NBQ0hFCiAgICApCgogICAgIyBpbml0aWFsIHN5bmMgb2Ygb2JqZWN0cyBpbnRvIEFpcmZsb3cgREIKICAgIHN5bmNfd2l0aF9haXJmbG93KCkKCiAgICBpZiBzeW5jX2ZvcmV2ZXI6CiAgICAgICAgIyBkZWZpbmUgdmFyaWFibGVzIHVzZWQgdG8gdHJhY2sgaG93IGxvbmcgc2luY2UgbGFzdCByZWZyZXNoL3N5bmMKICAgICAgICB0ZW1wbGF0ZXNfc3luY19lcG9jaCA9IHRpbWUudGltZSgpCiAgICAgICAgb2JqZWN0c19zeW5jX2Vwb2NoID0gdGltZS50aW1lKCkKCiAgICAgICAgIyBtYWluIGxvb3AKICAgICAgICB3aGlsZSBUcnVlOgogICAgICAgICAgICAjIG1vbml0b3IgZm9yIHRlbXBsYXRlIHNlY3JldC9jb25maWdtYXAgdXBkYXRlcwogICAgICAgICAgICBpZiAodGltZS50aW1lKCkgLSB0ZW1wbGF0ZXNfc3luY19lcG9jaCkgPiBDT05GX19URU1QTEFURVNfU1lOQ19JTlRFUlZBTDoKICAgICAgICAgICAgICAgIGxvZ2dpbmcuZGVidWcoZiJ0ZW1wbGF0ZSBzeW5jIGludGVydmFsIHJlYWNoZWQsIHJlLXN5bmNpbmcgYWxsIHRlbXBsYXRlcy4uLiIpCiAgICAgICAgICAgICAgICBjaGFuZ2VkX3RlbXBsYXRlcyA9IHJlZnJlc2hfdGVtcGxhdGVfY2FjaGUoCiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVfbmFtZXM9VkFSX19URU1QTEFURV9OQU1FUywKICAgICAgICAgICAgICAgICAgICB0ZW1wbGF0ZV9tdGltZV9jYWNoZT1WQVJfX1RFTVBMQVRFX01USU1FX0NBQ0hFLAogICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlX3ZhbHVlX2NhY2hlPVZBUl9fVEVNUExBVEVfVkFMVUVfQ0FDSEUKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgIHRlbXBsYXRlc19zeW5jX2Vwb2NoID0gdGltZS50aW1lKCkKICAgICAgICAgICAgICAgIGlmIGNoYW5nZWRfdGVtcGxhdGVzOgogICAgICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmInRlbXBsYXRlIHZhbHVlcyBoYXZlIGNoYW5nZWQ6IFt7JywnLmpvaW4oY2hhbmdlZF90ZW1wbGF0ZXMpfV0iKQogICAgICAgICAgICAgICAgICAgIHN5bmNfd2l0aF9haXJmbG93KCkKICAgICAgICAgICAgICAgICAgICBvYmplY3RzX3N5bmNfZXBvY2ggPSB0aW1lLnRpbWUoKQoKICAgICAgICAgICAgIyBtb25pdG9yIGZvciBleHRlcm5hbCBjaGFuZ2VzIHRvIG9iamVjdHMgKGxpa2UgZnJvbSBVSSkKICAgICAgICAgICAgaWYgKHRpbWUudGltZSgpIC0gb2JqZWN0c19zeW5jX2Vwb2NoKSA+IENPTkZfX09CSkVDVFNfU1lOQ19JTlRFUlZBTDoKICAgICAgICAgICAgICAgIGxvZ2dpbmcuZGVidWcoZiJzeW5jIGludGVydmFsIHJlYWNoZWQsIHJlLXN5bmNpbmcgYWxsIG9iamVjdHMuLi4iKQogICAgICAgICAgICAgICAgc3luY193aXRoX2FpcmZsb3coKQogICAgICAgICAgICAgICAgb2JqZWN0c19zeW5jX2Vwb2NoID0gdGltZS50aW1lKCkKCiAgICAgICAgICAgICMgZW5zdXJlIHdlIGRvbnQgbG9vcCB0b28gZmFzdAogICAgICAgICAgICB0aW1lLnNsZWVwKDAuNSkKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKIyMjIyBFTkQ6IEdMT0JBTCBDT0RFICMjIyMKIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMKCgojIyMjIyMjIyMjIyMjCiMjIEltcG9ydHMgIyMKIyMjIyMjIyMjIyMjIwppbXBvcnQgc3lzCmZyb20gd2Vya3pldWcuc2VjdXJpdHkgaW1wb3J0IGNoZWNrX3Bhc3N3b3JkX2hhc2gsIGdlbmVyYXRlX3Bhc3N3b3JkX2hhc2gKaW1wb3J0IGFpcmZsb3cud3d3LmFwcCBhcyB3d3dfYXBwCmZsYXNrX2FwcCA9IHd3d19hcHAuY3JlYXRlX2FwcCgpCmZsYXNrX2FwcGJ1aWxkZXIgPSBmbGFza19hcHAuYXBwYnVpbGRlcgoKIyBhaXJmbG93IHVzZXMgaXRzIG93biBpbmNvbXBhdGlibGUgRkFCIG1vZGVscyBpbiAyLjMuMCsKdHJ5OgogIGZyb20gYWlyZmxvdy53d3cuZmFiX3NlY3VyaXR5LnNxbGEubW9kZWxzIGltcG9ydCBVc2VyLCBSb2xlCmV4Y2VwdCBNb2R1bGVOb3RGb3VuZEVycm9yOgogIGZyb20gZmxhc2tfYXBwYnVpbGRlci5zZWN1cml0eS5zcWxhLm1vZGVscyBpbXBvcnQgVXNlciwgUm9sZQoKCiMjIyMjIyMjIyMjIyMKIyMgQ2xhc3NlcyAjIwojIyMjIyMjIyMjIyMjCmNsYXNzIFVzZXJXcmFwcGVyKG9iamVjdCk6CiAgICBkZWYgX19pbml0X18oCiAgICAgICAgICAgIHNlbGYsCiAgICAgICAgICAgIHVzZXJuYW1lOiBzdHIsCiAgICAgICAgICAgIGZpcnN0X25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgICAgICAgICBsYXN0X25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lLAogICAgICAgICAgICBlbWFpbDogT3B0aW9uYWxbc3RyXSA9IE5vbmUsCiAgICAgICAgICAgIHJvbGVzOiBPcHRpb25hbFtMaXN0W3N0cl1dID0gTm9uZSwKICAgICAgICAgICAgcGFzc3dvcmQ6IE9wdGlvbmFsW3N0cl0gPSBOb25lCiAgICApOgogICAgICAgIHNlbGYudXNlcm5hbWUgPSB1c2VybmFtZQogICAgICAgIHNlbGYuX2ZpcnN0X25hbWUgPSBmaXJzdF9uYW1lCiAgICAgICAgc2VsZi5fbGFzdF9uYW1lID0gbGFzdF9uYW1lCiAgICAgICAgc2VsZi5fZW1haWwgPSBlbWFpbAogICAgICAgIHNlbGYucm9sZXMgPSByb2xlcwogICAgICAgIHNlbGYuX3Bhc3N3b3JkID0gcGFzc3dvcmQKCiAgICBAcHJvcGVydHkKICAgIGRlZiBmaXJzdF9uYW1lKHNlbGYpIC0+IHN0cjoKICAgICAgICByZXR1cm4gc3RyaW5nX3N1YnN0aXR1dGlvbihzZWxmLl9maXJzdF9uYW1lLCBWQVJfX1RFTVBMQVRFX1ZBTFVFX0NBQ0hFKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGxhc3RfbmFtZShzZWxmKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIHN0cmluZ19zdWJzdGl0dXRpb24oc2VsZi5fbGFzdF9uYW1lLCBWQVJfX1RFTVBMQVRFX1ZBTFVFX0NBQ0hFKQoKICAgIEBwcm9wZXJ0eQogICAgZGVmIGVtYWlsKHNlbGYpIC0+IHN0cjoKICAgICAgICByZXR1cm4gc3RyaW5nX3N1YnN0aXR1dGlvbihzZWxmLl9lbWFpbCwgVkFSX19URU1QTEFURV9WQUxVRV9DQUNIRSkKCiAgICBAcHJvcGVydHkKICAgIGRlZiBwYXNzd29yZChzZWxmKSAtPiBzdHI6CiAgICAgICAgcmV0dXJuIHN0cmluZ19zdWJzdGl0dXRpb24oc2VsZi5fcGFzc3dvcmQsIFZBUl9fVEVNUExBVEVfVkFMVUVfQ0FDSEUpCgogICAgZGVmIGFzX2RpY3Qoc2VsZikgLT4gRGljdFtzdHIsIHN0cl06CiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgICAgInVzZXJuYW1lIjogc2VsZi51c2VybmFtZSwKICAgICAgICAgICAgImZpcnN0X25hbWUiOiBzZWxmLmZpcnN0X25hbWUsCiAgICAgICAgICAgICJsYXN0X25hbWUiOiBzZWxmLmxhc3RfbmFtZSwKICAgICAgICAgICAgImVtYWlsIjogc2VsZi5lbWFpbCwKICAgICAgICAgICAgInJvbGVzIjogW2ZpbmRfcm9sZShyb2xlX25hbWU9cm9sZV9uYW1lKSBmb3Igcm9sZV9uYW1lIGluIHNlbGYucm9sZXNdLAogICAgICAgICAgICAicGFzc3dvcmQiOiBzZWxmLnBhc3N3b3JkCiAgICAgICAgfQoKCiMjIyMjIyMjIyMjIyMjIwojIyBWYXJpYWJsZXMgIyMKIyMjIyMjIyMjIyMjIyMjClZBUl9fVEVNUExBVEVfTkFNRVMgPSBbCl0KVkFSX19URU1QTEFURV9NVElNRV9DQUNIRSA9IHt9ClZBUl9fVEVNUExBVEVfVkFMVUVfQ0FDSEUgPSB7fQpWQVJfX1VTRVJfV1JBUFBFUlMgPSB7CiAgImFkbWluIjogVXNlcldyYXBwZXIoCiAgICB1c2VybmFtZT0iYWRtaW4iLAogICAgZmlyc3RfbmFtZT0iYWRtaW4iLAogICAgbGFzdF9uYW1lPSJhZG1pbiIsCiAgICBlbWFpbD0iYWRtaW5AZXhhbXBsZS5jb20iLAogICAgcm9sZXM9WyAgICAgICAgIkFkbWluIiwKICAgIF0sCiAgICBwYXNzd29yZD0iYWRtaW4iLAogICksCn0KCgojIyMjIyMjIyMjIyMjIyMKIyMgRnVuY3Rpb25zICMjCiMjIyMjIyMjIyMjIyMjIwpkZWYgZmluZF9yb2xlKHJvbGVfbmFtZTogc3RyKSAtPiBSb2xlOgogICAgIiIiCiAgICBHZXQgdGhlIEZBQiBSb2xlIG1vZGVsIGFzc29jaWF0ZWQgd2l0aCBhIGByb2xlX25hbWVgLgogICAgIiIiCiAgICBmb3VuZF9yb2xlID0gZmxhc2tfYXBwYnVpbGRlci5zbS5maW5kX3JvbGUocm9sZV9uYW1lKQogICAgaWYgZm91bmRfcm9sZToKICAgICAgICByZXR1cm4gZm91bmRfcm9sZQogICAgZWxzZToKICAgICAgICB2YWxpZF9yb2xlcyA9IGZsYXNrX2FwcGJ1aWxkZXIuc20uZ2V0X2FsbF9yb2xlcygpCiAgICAgICAgbG9nZ2luZy5lcnJvcihmIkZhaWxlZCB0byBmaW5kIHJvbGU9YHtyb2xlX25hbWV9YCwgdmFsaWQgcm9sZXMgYXJlOiB7dmFsaWRfcm9sZXN9IikKICAgICAgICBzeXMuZXhpdCgxKQoKCmRlZiBjb21wYXJlX3JvbGVfbGlzdHMocm9sZV9saXN0XzE6IExpc3RbUm9sZV0sIHJvbGVfbGlzdF8yOiBMaXN0W1JvbGVdKSAtPiBib29sOgogICAgIiIiCiAgICBDaGVjayBpZiB0d28gbGlzdHMgb2YgRkFCIFJvbGVzIGNvbnRhaW4gdGhlIHNhbWUgcm9sZXMgKGlnbm9yZXMgZHVwbGljYXRlcyBhbmQgb3JkZXIpLgogICAgIiIiCiAgICBuYW1lX3NldF8xID0gc2V0KHJvbGUubmFtZSBmb3Igcm9sZSBpbiByb2xlX2xpc3RfMSkKICAgIG5hbWVfc2V0XzIgPSBzZXQocm9sZS5uYW1lIGZvciByb2xlIGluIHJvbGVfbGlzdF8yKQogICAgcmV0dXJuIG5hbWVfc2V0XzEgPT0gbmFtZV9zZXRfMgoKCgpkZWYgY29tcGFyZV91c2Vycyh1c2VyX2RpY3Q6IERpY3QsIHVzZXJfbW9kZWw6IFVzZXIpIC0+IGJvb2w6CiAgICAiIiIKICAgIENoZWNrIGlmIHVzZXIgaW5mbyAoc3RvcmVkIGluIGRpY3QpIGlzIGlkZW50aWNhbCB0byBhIEZBQiBVc2VyIG1vZGVsLgogICAgIiIiCiAgICByZXR1cm4gKAogICAgICAgICAgICB1c2VyX2RpY3RbInVzZXJuYW1lIl0gPT0gdXNlcl9tb2RlbC51c2VybmFtZQogICAgICAgICAgICBhbmQgdXNlcl9kaWN0WyJmaXJzdF9uYW1lIl0gPT0gdXNlcl9tb2RlbC5maXJzdF9uYW1lCiAgICAgICAgICAgIGFuZCB1c2VyX2RpY3RbImxhc3RfbmFtZSJdID09IHVzZXJfbW9kZWwubGFzdF9uYW1lCiAgICAgICAgICAgIGFuZCB1c2VyX2RpY3RbImVtYWlsIl0gPT0gdXNlcl9tb2RlbC5lbWFpbAogICAgICAgICAgICBhbmQgY29tcGFyZV9yb2xlX2xpc3RzKHVzZXJfZGljdFsicm9sZXMiXSwgdXNlcl9tb2RlbC5yb2xlcykKICAgICAgICAgICAgYW5kIGNoZWNrX3Bhc3N3b3JkX2hhc2gocHdoYXNoPXVzZXJfbW9kZWwucGFzc3dvcmQsIHBhc3N3b3JkPXVzZXJfZGljdFsicGFzc3dvcmQiXSkKICAgICkKCgpkZWYgc3luY191c2VyKHVzZXJfd3JhcHBlcjogVXNlcldyYXBwZXIpIC0+IE5vbmU6CiAgICAiIiIKICAgIFN5bmMgdGhlIFVzZXIgZGVmaW5lZCBieSBhIHByb3ZpZGVkIFVzZXJXcmFwcGVyIGludG8gdGhlIEZBQiBEQi4KICAgICIiIgogICAgdXNlcm5hbWUgPSB1c2VyX3dyYXBwZXIudXNlcm5hbWUKICAgIHVfbmV3ID0gdXNlcl93cmFwcGVyLmFzX2RpY3QoKQogICAgdV9vbGQgPSBmbGFza19hcHBidWlsZGVyLnNtLmZpbmRfdXNlcih1c2VybmFtZT11c2VybmFtZSkKCiAgICBpZiBub3QgdV9vbGQ6CiAgICAgICAgbG9nZ2luZy5pbmZvKGYiVXNlcj1ge3VzZXJuYW1lfWAgaXMgbWlzc2luZywgYWRkaW5nLi4uIikKICAgICAgICBjcmVhdGVkX3VzZXIgPSBmbGFza19hcHBidWlsZGVyLnNtLmFkZF91c2VyKAogICAgICAgICAgICB1c2VybmFtZT11X25ld1sidXNlcm5hbWUiXSwKICAgICAgICAgICAgZmlyc3RfbmFtZT11X25ld1siZmlyc3RfbmFtZSJdLAogICAgICAgICAgICBsYXN0X25hbWU9dV9uZXdbImxhc3RfbmFtZSJdLAogICAgICAgICAgICBlbWFpbD11X25ld1siZW1haWwiXSwKICAgICAgICAgICAgIyBpbiBvbGQgdmVyc2lvbnMgb2YgZmxhc2tfYXBwYnVpbGRlciBgYWRkX3VzZXIocm9sZT1gIGNhbiBvbmx5IGFkZCBleGFjdGx5IG9uZSByb2xlCiAgICAgICAgICAgICMgKHVuY2hlY2tlZCAwIGluZGV4IGlzIHNhZmUgYmVjYXVzZSB3ZSByZXF1aXJlIGF0IGxlYXN0IG9uZSByb2xlIHVzaW5nIGhlbG0gdmFsdWVzIHZhbGlkYXRpb24pCiAgICAgICAgICAgIHJvbGU9dV9uZXdbInJvbGVzIl1bMF0sCiAgICAgICAgICAgIHBhc3N3b3JkPXVfbmV3WyJwYXNzd29yZCJdCiAgICAgICAgKQogICAgICAgIGlmIGNyZWF0ZWRfdXNlcjoKICAgICAgICAgICAgIyBhZGQgdGhlIGZ1bGwgbGlzdCBvZiByb2xlcyAod2Ugb25seSBhZGRlZCB0aGUgZmlyc3Qgb25lIGFib3ZlKQogICAgICAgICAgICBjcmVhdGVkX3VzZXIucm9sZXMgPSB1X25ld1sicm9sZXMiXQogICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJVc2VyPWB7dXNlcm5hbWV9YCB3YXMgc3VjY2Vzc2Z1bGx5IGFkZGVkLiIpCiAgICAgICAgZWxzZToKICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkZhaWxlZCB0byBhZGQgVXNlcj1ge3VzZXJuYW1lfWAiKQogICAgICAgICAgICBzeXMuZXhpdCgxKQogICAgZWxzZToKICAgICAgICBpZiBjb21wYXJlX3VzZXJzKHVfbmV3LCB1X29sZCk6CiAgICAgICAgICAgIHBhc3MKICAgICAgICBlbHNlOgogICAgICAgICAgICBsb2dnaW5nLmluZm8oZiJVc2VyPWB7dXNlcm5hbWV9YCBleGlzdHMgYnV0IGhhcyBjaGFuZ2VkLCB1cGRhdGluZy4uLiIpCiAgICAgICAgICAgIHVfb2xkLmZpcnN0X25hbWUgPSB1X25ld1siZmlyc3RfbmFtZSJdCiAgICAgICAgICAgIHVfb2xkLmxhc3RfbmFtZSA9IHVfbmV3WyJsYXN0X25hbWUiXQogICAgICAgICAgICB1X29sZC5lbWFpbCA9IHVfbmV3WyJlbWFpbCJdCiAgICAgICAgICAgIHVfb2xkLnJvbGVzID0gdV9uZXdbInJvbGVzIl0KICAgICAgICAgICAgdV9vbGQucGFzc3dvcmQgPSBnZW5lcmF0ZV9wYXNzd29yZF9oYXNoKHVfbmV3WyJwYXNzd29yZCJdKQogICAgICAgICAgICAjIHN0cmFuZ2UgY2hlY2sgZm9yIEZhbHNlIGlzIGJlY2F1c2UgdXBkYXRlX3VzZXIoKSByZXR1cm5zIE5vbmUgZm9yIHN1Y2Nlc3MKICAgICAgICAgICAgIyBidXQgaW4gZnV0dXJlIG1pZ2h0IHJldHVybiB0aGUgVXNlciBtb2RlbAogICAgICAgICAgICBpZiBub3QgKGZsYXNrX2FwcGJ1aWxkZXIuc20udXBkYXRlX3VzZXIodV9vbGQpIGlzIEZhbHNlKToKICAgICAgICAgICAgICAgIGxvZ2dpbmcuaW5mbyhmIlVzZXI9YHt1c2VybmFtZX1gIHdhcyBzdWNjZXNzZnVsbHkgdXBkYXRlZC4iKQogICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgbG9nZ2luZy5lcnJvcihmIkZhaWxlZCB0byB1cGRhdGUgVXNlcj1ge3VzZXJuYW1lfWAiKQogICAgICAgICAgICAgICAgc3lzLmV4aXQoMSkKCgpkZWYgc3luY19hbGxfdXNlcnModXNlcl93cmFwcGVyczogRGljdFtzdHIsIFVzZXJXcmFwcGVyXSkgLT4gTm9uZToKICAgICIiIgogICAgU3luYyBhbGwgdXNlcnMgaW4gcHJvdmlkZWQgYHVzZXJfd3JhcHBlcnNgLgogICAgIiIiCiAgICBsb2dnaW5nLmluZm8oIkJFR0lOOiBhaXJmbG93IHVzZXJzIHN5bmMiKQogICAgZm9yIHVzZXJfd3JhcHBlciBpbiB1c2VyX3dyYXBwZXJzLnZhbHVlcygpOgogICAgICAgIHN5bmNfdXNlcih1c2VyX3dyYXBwZXIpCiAgICBsb2dnaW5nLmluZm8oIkVORDogYWlyZmxvdyB1c2VycyBzeW5jIikKCiAgICAjIGVuc3VyZXMgdGhhbiBhbnkgU1FMQWxjaGVteSBzZXNzaW9ucyBhcmUgY2xvc2VkIChzbyB3ZSBkb24ndCBob2xkIGEgY29ubmVjdGlvbiB0byB0aGUgZGF0YWJhc2UpCiAgICBmbGFza19hcHAuZG9fdGVhcmRvd25fYXBwY29udGV4dCgpCgoKZGVmIHN5bmNfd2l0aF9haXJmbG93KCkgLT4gTm9uZToKICAgICIiIgogICAgUHJlZm9ybSBhIHN5bmMgb2YgYWxsIG9iamVjdHMgd2l0aCBhaXJmbG93IChub3RlLCBgc3luY193aXRoX2FpcmZsb3coKWAgaXMgY2FsbGVkIGluIGBtYWluKClgIHRlbXBsYXRlKS4KICAgICIiIgogICAgc3luY19hbGxfdXNlcnModXNlcl93cmFwcGVycz1WQVJfX1VTRVJfV1JBUFBFUlMpCgoKIyMjIyMjIyMjIyMjIyMKIyMgUnVuIE1haW4gIyMKIyMjIyMjIyMjIyMjIyMKbWFpbihzeW5jX2ZvcmV2ZXI9VHJ1ZSk="
